<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TIA CECILIA — Loja Digital</title>

  <style>
    /* ====== Reset e básico ====== */
    :root {
      --primary:#F9E6E0;
      --accent:#FFB6B6;
      --text:#333;
      --muted:#666;
    }
    * { box-sizing:border-box }
    body{
      font-family:Inter, system-ui, -apple-system, 'Segoe UI', Arial;
      margin:0; color:var(--text); background:#fff;
    }

    header{
      background:linear-gradient(180deg,var(--primary),#fff);
      padding:18px 20px; border-bottom:1px solid #eee;
      display:flex; align-items:center; justify-content:space-between;
    }
    .brand{ display:flex; gap:12px; align-items:center }
    .logo{
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(135deg,#fff,rgba(255,255,255,0.3));
      display:flex; align-items:center; justify-content:center;
      font-weight:700; color:#b33;
    }
    h1{ margin:0; font-size:20px }
    .subtitle{ font-size:13px; color:var(--muted) }

    /* Layout */
    main{ padding:20px; max-width:1200px; margin:auto }
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(240px,1fr));
      gap:18px;
    }
    .card{
      border:1px solid #f0e6e6; border-radius:12px;
      padding:14px; background:#fff;
      box-shadow:0 6px 18px rgba(200,150,150,0.03);
    }
    .cover{
      width:100%; height:220px; border-radius:8px;
      background-size:cover; background-position:center;
      margin-bottom:12px;
    }
    .title{ margin:6px 0; font-weight:700 }
    .price{ color:#b23; font-weight:800; margin:6px 0 }
    .meta{ font-size:13px; color:var(--muted) }

    .btn{
      padding:8px 12px;
      border-radius:8px;
      background:var(--accent);
      color:#6b0000;
      font-weight:700;
      border:none;
      cursor:pointer;
      text-align:center;
    }
    .btn.secondary{
      background:#fff;
      border:1px solid #ffdede;
      color:#b23;
    }

    footer{
      padding:18px;
      text-align:center;
      color:var(--muted);
    }

    /* Carrinho */
    .cart-btn{ position:relative }
    .cart-count{
      position:absolute; right:-8px; top:-8px;
      background:#b23; color:#fff;
      width:22px; height:22px;
      display:flex; align-items:center; justify-content:center;
      border-radius:999px;
      font-size:12px;
    }

    /* Modal carrinho */
    .modal{
      position:fixed;
      right:20px; bottom:20px;
      width:380px; padding:16px;
      background:#fff;
      border-radius:12px;
      box-shadow:0 20px 60px rgba(0,0,0,0.12);
      display:none;
      z-index:50;
    }
    .modal.open{ display:block }

    .cart-item{
      display:flex; gap:12px;
      padding:12px 0; border-bottom:1px dashed #eee;
    }
    .cart-item img{
      width:64px; height:64px;
      border-radius:8px;
      object-fit:cover;
    }

    .qty{ display:flex; gap:6px; align-items:center }
    .small{ font-size:13px; color:var(--muted) }

    .checkout-actions{ display:flex; gap:8px; margin-top:12px }

    .notice{
      background:#fff3f3;
      border-left:4px solid #ffdede;
      padding:10px;
      border-radius:8px;
      margin-bottom:12px;
    }

    @media(max-width:600px){
      .modal{ right:10px; left:10px; width:auto }
    }
  </style>
</head>

<body>

<header>
  <div class="brand">
    <div class="logo">TC</div>
    <div>
      <h1>TIA CECILIA — Loja Digital</h1>
      <div class="subtitle">Recursos pedagógicos e planilhas — PDFs & Excel</div>
    </div>
  </div>

  <div style="display:flex;gap:12px;align-items:center">
    <div class="notice">Estilo: Infantil • Produtos iniciais adicionados</div>
    <button id="openCart" class="btn cart-btn">
      Carrinho <span id="cartCount" class="cart-count">0</span>
    </button>
  </div>
</header>

<main>

  <section style="margin-bottom:18px">
    <h2 style="margin:0">Produtos</h2>
    <div class="small">Use o botão "Adicionar no Carrinho"</div>
  </section>

  <!-- Produtos via JS -->
  <section id="productGrid" class="grid"></section>

  <p class="small" style="margin-top:20px">
    Para editar os produtos, modifique o array <code>PRODUCTS</code> no final do arquivo.
  </p>

</main>

<!-- Modal Carrinho -->
<div id="cartModal" class="modal">
  <h3>Seu Carrinho</h3>
  <div id="cartItems"></div>

  <div style="margin-top:12px;display:flex;justify-content:space-between">
    <strong>Total:</strong>
    <strong id="cartTotal">R$ 0,00</strong>
  </div>

  <div class="checkout-actions">
    <button id="checkoutMP" class="btn">Pagar com Mercado Pago</button>
    <button id="checkoutPix" class="btn secondary">Pagar com PIX</button>
  </div>

  <div style="margin-top:10px;display:flex;justify-content:space-between">
    <button id="closeCart" class="btn secondary">Fechar</button>
    <button id="clearCart" class="btn secondary">Esvaziar</button>
  </div>

  <!-- PIX interno -->
  <div id="pixBox" style="display:none;margin-top:12px;padding:10px;border:1px dashed #eee;border-radius:8px">
    <p class="small">Copie o código PIX abaixo:</p>
    <textarea id="pixPayload" style="width:100%;height:88px;font-size:13px">
00020126360014BR.GOV.BCB.PIX0136+5584999999995204000053039865408.005802BR5925TIA CECILIA6009FORTALEZA61080540900062070503***6304FFFF
    </textarea>

    <div style="display:flex;gap:8px;margin-top:6px">
      <button id="copyPix" class="btn">Copiar PIX</button>
      <button id="closePix" class="btn secondary">Fechar PIX</button>
    </div>
  </div>
</div>

<footer>
  <small>Feito com ❤️ para TIA CECILIA — pronto para GitHub Pages</small>
</footer>


<!-- ======================= SCRIPT ======================= -->
<script>
/* ============================================
   PRODUTOS — EDITE AQUI
============================================ */
const PRODUCTS = [
  {
    id:'pack-alfabetizacao',
    title:'Pack Alfabetização — Amostra',
    price:12,
    description:'PDF amostra com atividades iniciais (9 páginas).',
    cover:'cover_pack_alfabetizacao.png',
    file:'pack_alfabetizacao_amostra.pdf'
  },
  {
    id:'planner-2025',
    title:'Planner Professor 2025',
    price:12,
    description:'Planner completo para professores.',
    cover:'cover_planner_2025.png',
    file:'planner_professor_2025.pdf'
  },
  {
    id:'ativ-infantil',
    title:'Atividades Educação Infantil',
    price:10,
    description:'Jogos e fichas para crianças de 3 a 6 anos.',
    cover:'cover_atividades_infantil.png',
    file:'atividades_educacao_infantil.pdf'
  },
  {
    id:'planilha-fin',
    title:'Planilha Financeira Pessoal',
    price:20,
    description:'Excel com resumo automático, metas e gráficos.',
    cover:'cover_planilha_financeira.png',
    file:'planilha_financeira.xlsx'
  }
];

const money = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

/* ===== RENDER PRODUTOS ===== */
const grid = document.getElementById('productGrid');
PRODUCTS.forEach(p=>{
  const card = document.createElement('article');
  card.className='card';
  card.innerHTML = `
    <div class="cover" style="background-image:url('${p.cover}')"></div>
    <div class="title">${p.title}</div>
    <div class="meta">${p.description}</div>

    <div style="display:flex;justify-content:space-between;margin-top:12px">
      <div>
        <div class="price">${money(p.price)}</div>
        <div class="small">Download imediato</div>
      </div>

      <div style="display:flex;flex-direction:column;gap:8px">
        <button class="btn add-to-cart" data-id="${p.id}">Adicionar no Carrinho</button>
        <a href="${p.file}" target="_blank" class="btn secondary">Visualizar</a>
      </div>
    </div>
  `;
  grid.appendChild(card);
});

/* ========== CARRINHO ========== */
const CART_KEY = "tia_cecilia_cart_v1";
let cart = JSON.parse(localStorage.getItem(CART_KEY) || "{}");

function saveCart(){
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
  updateCartUI();
}

function addToCart(id){
  cart[id] = (cart[id]||0) + 1;
  saveCart();
}

function removeFromCart(id){
  delete cart[id];
  saveCart();
}

function setQty(id, qty){
  if(qty <= 0) removeFromCart(id);
  else { cart[id] = qty; saveCart(); }
}

function cartItemsArray(){
  return Object.keys(cart).map(id => ({
    ...PRODUCTS.find(p=>p.id===id),
    qty:cart[id]
  }));
}

function cartTotal(){
  return cartItemsArray().reduce((t,i)=>t + i.price * i.qty, 0);
}

/* Eventos */
document.querySelectorAll('.add-to-cart').forEach(btn=>{
  btn.addEventListener('click', e=>{
    addToCart(e.target.dataset.id);
    e.target.style.transform='scale(0.95)';
    setTimeout(()=>e.target.style.transform='',150);
  });
});

const cartModal = document.getElementById('cartModal');
document.getElementById('openCart').onclick = ()=>{
  cartModal.classList.toggle('open');
  renderCartItems();
};
document.getElementById('closeCart').onclick = ()=> cartModal.classList.remove('open');
document.getElementById('clearCart').onclick = ()=>{ cart={}; saveCart(); };

function renderCartItems(){
  const box = document.getElementById('cartItems');
  box.innerHTML='';

  const items = cartItemsArray();
  if(items.length===0){
    box.innerHTML = `<p class="small">Seu carrinho está vazio.</p>`;
    return;
  }

  items.forEach(it=>{
    const div = document.createElement('div');
    div.className='cart-item';
    div.innerHTML = `
      <img src="${it.cover}">
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between">
          <div>
            <strong>${it.title}</strong>
            <div class="small">${money(it.price)} cada</div>
          </div>
          <div style="text-align:right">
            <strong>${money(it.price * it.qty)}</strong>
            <div class="small">Qtd: ${it.qty}</div>
          </div>
        </div>

        <div style="margin-top:8px;display:flex;gap:8px">
          <div class="qty">
            <button class="btn secondary dec" data-id="${it.id}">-</button>
            <div class="small" style="padding:6px 10px;border:1px solid #eee;border-radius:6px">${it.qty}</div>
            <button class="btn inc" data-id="${it.id}">+</button>
          </div>

          <button class="btn secondary remove" data-id="${it.id}">Remover</button>
        </div>
      </div>
    `;
    box.appendChild(div);
  });

  box.querySelectorAll('.dec').forEach(b=>b.onclick = ()=>setQty(b.dataset.id, cart[b.dataset.id]-1));
  box.querySelectorAll('.inc').forEach(b=>b.onclick = ()=>setQty(b.dataset.id, cart[b.dataset.id]+1));
  box.querySelectorAll('.remove').forEach(b=>b.onclick = ()=>removeFromCart(b.dataset.id));

  document.getElementById('cartTotal').textContent = money(cartTotal());
}

function updateCartUI(){
  document.getElementById('cartCount').textContent =
    Object.values(cart).reduce((a,b)=>a+b,0);
  if(cartModal.classList.contains('open')) renderCartItems();
}
updateCartUI();

/* ========== CHECKOUT MERCADO PAGO ========== */

// CHAVE PÚBLICA
const MP_PUBLIC_KEY = "TEST-9d1e3df5-95e0-4b5e-a32d-f3ad69303815";

// ACCESS TOKEN — no frontend apenas para testes
const MP_ACCESS_TOKEN = "TEST-214699310458254-112813-dcd8d534d55423ea64ed273f44701838-776186295";

const mp = new MercadoPago(MP_PUBLIC_KEY, { locale:"pt-BR" });

document.getElementById('checkoutMP').addEventListener('click', async ()=>{

  if(!Object.keys(cart).length) return alert("Carrinho vazio.");

  const items = cartItemsArray().map(p=>({
    title:p.title,
    quantity:p.qty,
    unit_price:p.price,
    currency_id:"BRL"
  }));

  const res = await fetch("https://api.mercadopago.com/checkout/preferences",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer " + MP_ACCESS_TOKEN
    },
    body:JSON.stringify({
      items,
      external_reference:"pedido_" + Date.now(),
      auto_return:"approved"
    })
  });

  const pref = await res.json();
  if(!pref.id){
    console.log(pref);
    return alert("Erro ao criar preferência MP");
  }

  mp.checkout({
    preference:{ id:pref.id },
    autoOpen:true
  });
});

/* ========== PIX ========== */
const pixBox = document.getElementById('pixBox');
document.getElementById('checkoutPix').onclick = ()=>{
  if(!Object.keys(cart).length) return alert("Carrinho vazio.");
  pixBox.style.display='block';
};
document.getElementById('copyPix').onclick = ()=>{
  navigator.clipboard.writeText(document.getElementById('pixPayload').value);
  alert("PIX copiado!");
};
document.getElementById('closePix').onclick = ()=> pixBox.style.display='none';

</script>

<!-- Mercado Pago SDK -->
<script src="https://sdk.mercadopago.com/js/v2"></script>

</body>
</html>
